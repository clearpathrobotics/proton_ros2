nodes:
  - name: pc
    heartbeat:
      enabled: true
      period: 1000
    endpoints:
      - id: 0
        type: udp4
        ip: 127.0.0.1
        port: 11416
  - name: mcu
    heartbeat:
      enabled: true
      period: 100
    endpoints:
      - id: 0
        type: udp4
        ip: 127.0.0.1
        port: 11417

connections:
  - first: {node: mcu, id: 0}
    second: {node: pc, id: 0}


bundles:
  - name: log
    id: 0x100
    producers: mcu
    consumers: pc
    signals:
      - {name: level, type: uint32}
      - {name: name, type: string, value: proton_logger}
      - {name: msg, type: string, capacity: 64}
      - {name: file, type: string, capacity: 64}
      - {name: function, type: string, capacity: 64}
      - {name: line, type: uint32}
  - name: status
    id: 0x101
    producers: mcu
    consumers: pc
    signals:
      - {name: header_frame_id, type: string, value: mcu_link}
      - {name: hardware_id, type: string, capacity: 16}
      - {name: firmware_version, type: string, capacity: 16}
      - {name: mcu_uptime_sec, type: int32}
      - {name: mcu_uptime_nanosec, type: uint32}
      - {name: connection_uptime_sec, type: int32}
      - {name: connection_uptime_nanosec, type: uint32}
  - name: power
    id: 0x102
    producers: mcu
    consumers: pc
    signals:
      - {name: header_frame_id, type: string, value: mcu_link}

      - {name: shore_power_connected, type: int32, value: -1}
      - {name: battery_connected, type: int32, value: 1}
      - {name: power_12v_user_nominal, type: int32, value: -1}
      - {name: charger_connected, type: int32, value: -1}
      - {name: charging_complete, type: int32, value: -1}

      - {name: measured_voltages, type: list_float, length: 13}
      - {name: CC01_BATTERY_VOLTAGE, type: uint32, value: 0}
      - {name: CC01_USER_BATTERY_VOLTAGE, type: uint32, value: 1}
      - {name: CC01_USER_24V_VOLTAGE, type: uint32, value: 2}
      - {name: CC01_USER_12VB_VOLTAGE, type: uint32, value: 3}
      - {name: CC01_SYSTEM_12V_VOLTAGE, type: uint32, value: 4}
      - {name: CC01_EXPANSION_VOLTAGE, type: uint32, value: 5}
      - {name: CC01_BREAKOUT_24V_AUX_VOLTAGE, type: uint32, value: 6}
      - {name: CC01_BREAKOUT_12V_AUX_VOLTAGE, type: uint32, value: 7}
      - {name: CC01_BREAKOUT_USER_12VA_VOLTAGE, type: uint32, value: 8}
      - {name: CC01_BREAKOUT_LYNX1_VOLTAGE, type: uint32, value: 9}
      - {name: CC01_BREAKOUT_LYNX2_VOLTAGE, type: uint32, value: 10}
      - {name: CC01_BREAKOUT_LYNX3_VOLTAGE, type: uint32, value: 11}
      - {name: CC01_BREAKOUT_LYNX4_VOLTAGE, type: uint32, value: 12}

      - {name: measured_currents, type: list_float, length: 13}
      - {name: CC01_BATTERY_PACK_CURRENT, type: uint32, value: 0}
      - {name: CC01_USER_BATTERY_CURRENT, type: uint32, value: 1}
      - {name: CC01_AUX_HES_CURRENT, type: uint32, value: 2}
      - {name: CC01_SYSTEM_12V_CURRENT, type: uint32, value: 3}
      - {name: CC01_24V_AUX_CURRENT, type: uint32, value: 4}
      - {name: CC01_12V_AUX_CURRENT, type: uint32, value: 5}
      - {name: CC01_BREAKOUT_USER_24V_CURRENT, type: uint32, value: 6}
      - {name: CC01_BREAKOUT_USER_12VA_CURRENT, type: uint32, value: 7}
      - {name: CC01_BREAKOUT_USER_12VB_CURRENT, type: uint32, value: 8}
      - {name: CC01_BREAKOUT_LYNX1_CURRENT, type: uint32, value: 9}
      - {name: CC01_BREAKOUT_LYNX2_CURRENT, type: uint32, value: 10}
      - {name: CC01_BREAKOUT_LYNX3_CURRENT, type: uint32, value: 11}
      - {name: CC01_BREAKOUT_LYNX4_CURRENT, type: uint32, value: 12}
  - name: emergency_stop
    id: 0x103
    producers: mcu
    consumers: pc
    signals:
      - {name: data, type: bool}
  - name: temperature
    id: 0x104
    producers: mcu
    consumers: pc
    signals:
      - {name: header_frame_id, type: string, value: mcu_link}

      - {name: temperatures, type: list_float, length: 19}
      - {name: CC01_MCU, type: uint32, value: 0}
      - {name: CC01_FAN1, type: uint32, value: 1}
      - {name: CC01_FAN2, type: uint32, value: 2}
      - {name: CC01_FAN3, type: uint32, value: 3}
      - {name: CC01_FAN4, type: uint32, value: 4}
      - {name: CC01_FAN5, type: uint32, value: 5}
      - {name: CC01_FAN6, type: uint32, value: 6}
      - {name: CC01_FAN7, type: uint32, value: 7}
      - {name: CC01_FAN8, type: uint32, value: 8}
      - {name: CC01_5V_INDUCTOR, type: uint32, value: 9}
      - {name: CC01_MAIN_GND_LUG, type: uint32, value: 10}
      - {name: CC01_24V_DCDC, type: uint32, value: 11}
      - {name: CC01_12V_DCDC, type: uint32, value: 12}
      - {name: CC01_EXT_1, type: uint32, value: 13}
      - {name: CC01_EXT_2, type: uint32, value: 14}
      - {name: CC01_EXT_3, type: uint32, value: 15}
      - {name: CC01_EXT_4, type: uint32, value: 16}
      - {name: CC01_BREAKOUT_1, type: uint32, value: 17}
      - {name: CC01_BREAKOUT_2, type: uint32, value: 18}

  - name: stop_status
    id: 0x105
    producers: mcu
    consumers: pc
    signals:
      - {name: header_frame_id, type: string, value: mcu_link}
      - {name: stop_power_status, type: bool, value: True}
      - {name: external_stop_present, type: bool, value: False}
      - {name: needs_reset, type: bool}
  - name: pinout_state
    id: 0x106
    producers: mcu
    consumers: pc
    signals:
      - {name: header_frame_id, type: string, value: mcu_link}

      - {name: rails, type: list_bool, length: 1}
      - {name: CC01_USER_PWR_CTRL, type: uint32, value: 0}

      - {name: inputs, type: list_bool, length: 7}
      - {name: CC01_AUX_IN1, type: uint32, value: 0}
      - {name: CC01_AUX_IN2, type: uint32, value: 1}
      - {name: CC01_AUX_IN3, type: uint32, value: 2}
      - {name: CC01_GPI0, type: uint32, value: 3}
      - {name: CC01_GPI1, type: uint32, value: 4}
      - {name: CC01_GPI2, type: uint32, value: 5}
      - {name: CC01_GPI3, type: uint32, value: 6}

      - {name: outputs, type: list_bool, length: 7}
      - {name: output_periods, type: list_uint32, length: 7}
      - {name: CC01_AUX_OUT1, type: uint32, value: 0}
      - {name: CC01_AUX_OUT2, type: uint32, value: 1}
      - {name: CC01_AUX_OUT3, type: uint32, value: 2}
      - {name: CC01_GPO0, type: uint32, value: 3}
      - {name: CC01_GPO1, type: uint32, value: 4}
      - {name: CC01_GPO2, type: uint32, value: 5}
      - {name: CC01_GPO3, type: uint32, value: 6}
  - name: alerts
    id: 0x107
    producers: mcu
    consumers: pc
    signals:
      - {name: data, type: string, capacity: 86}
  - name: cmd_fans
    id: 0x200
    producers: pc
    consumers: mcu
    signals:
      - {name: fans, type: bytes, capacity: 8}
  - name: display_status
    id: 0x201
    producers: pc
    consumers: mcu
    signals:
      - {name: string1, type: string, capacity: 50}
      - {name: string2, type: string, capacity: 50}
  - name: cmd_lights
    id: 0x202
    producers: pc
    consumers: mcu
    signals:
      - {name: lights, type: list_bytes, length: 4, capacity: 3}
      # RGB indices
      - {name: RED, type: uint32, value: 0}
      - {name: GREEN, type: uint32, value: 1}
      - {name: BLUE, type: uint32, value: 2}
      # Corner indices
      - {name: FRONT_RIGHT, type: uint32, value: 0}
      - {name: FRONT_LEFT, type: uint32, value: 1}
      - {name: REAR_LEFT, type: uint32, value: 2}
      - {name: REAR_RIGHT, type: uint32, value: 3}

  - name: battery
    id: 0x203
    producers: pc
    consumers: mcu
    signals:
      - {name: percentage, type: float}
  - name: pinout_command
    id: 0x204
    producers: pc
    consumers: mcu
    signals:
      - {name: rails, type: list_bool, length: 1}
      - {name: CC01_USER_PWR_CTRL, type: uint32, value: 0}

      - {name: outputs, type: list_uint32, length: 7}
      - {name: CC01_AUX_OUT1, type: uint32, value: 0}
      - {name: CC01_AUX_OUT2, type: uint32, value: 1}
      - {name: CC01_AUX_OUT3, type: uint32, value: 2}
      - {name: CC01_GPO0, type: uint32, value: 3}
      - {name: CC01_GPO1, type: uint32, value: 4}
      - {name: CC01_GPO2, type: uint32, value: 5}
      - {name: CC01_GPO3, type: uint32, value: 6}
  - name: cmd_shutdown
    id: 0x300
    producers: pc
    consumers: mcu
  - name: cmd_shutdown_response
    id: 0x301
    producers: mcu
    consumers: pc
    signals:
      - {name: success, type: bool}
      - {name: message, type: string, capacity: 64}
  - name: clear_needs_reset
    id: 0x302
    producers: pc
    consumers: mcu
  - name: clear_needs_reset_response
    id: 0x303
    producers: mcu
    consumers: pc
    signals:
      - {name: success, type: bool}
      - {name: message, type: string, capacity: 64}

ros2:
  topics:
    - {topic: /rosout,                          message: rcl_interfaces/msg/Log,                    qos: rosout,      bundle: log}
    - {topic: platform/mcu/status,              message: clearpath_platform_msgs/msg/Status,        qos: sensor_data, bundle: status}
    - {topic: platform/mcu/status/power,        message: clearpath_platform_msgs/msg/Power,         qos: sensor_data, bundle: power}
    - {topic: platform/mcu/status/stop,         message: clearpath_platform_msgs/msg/StopStatus,    qos: sensor_data, bundle: stop_status}
    - {topic: platform/mcu/status/temperature,  message: clearpath_platform_msgs/msg/Temperature,   qos: sensor_data, bundle: temperature}
    - {topic: platform/mcu/status/pinout,       message: clearpath_platform_msgs/msg/PinoutState,   qos: sensor_data, bundle: pinout_state}
    - {topic: platform/mcu/status/alerts,       message: std_msgs/msg/String,                       qos: sensor_data, bundle: alerts}
    - {topic: platform/display/status,          message: clearpath_platform_msgs/msg/DisplayStatus, qos: sensor_data, bundle: display_status}
    - {topic: platform/emergency_stop,          message: std_msgs/msg/Bool,                         qos: sensor_data, bundle: emergency_stop}
    - {topic: platform/bms/state,               message: sensor_msgs/msg/BatteryState,              qos: sensor_data, bundle: battery}
    - {topic: platform/mcu/_cmd_fans,           message: clearpath_platform_msgs/msg/Fans,          qos: sensor_data, bundle: cmd_fans}
    - {topic: platform/mcu/_cmd_lights,         message: clearpath_platform_msgs/msg/Lights,        qos: sensor_data, bundle: cmd_lights}
    - {topic: platform/mcu/_cmd_pinout,         message: clearpath_platform_msgs/msg/PinoutCommand, qos: sensor_data, bundle: pinout_command}
  services:
    - {topic: platform/mcu/cmd_shutdown,            service: std_srvs/srv/Trigger, qos: services, request: cmd_shutdown, response: cmd_shutdown_response, timeout: 100}
    - {topic: platform/mcu/clear_estop_needs_reset, service: std_srvs/srv/Trigger, qos: services, request: clear_needs_reset, response: clear_needs_reset_response, timeout: 100}
